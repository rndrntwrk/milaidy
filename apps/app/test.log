$ vitest run --config vitest.config.ts test/electron/permissions-darwin.test.ts

 RUN  v2.1.9 /Users/shawwalters/eliza-workspace/milady/apps/app

(node:59237) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 32)
(Use `node --trace-warnings ...` to show where the warning was created)
(node:59237) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 34)
 ❯ test/electron/permissions-darwin.test.ts (39 tests | 29 failed) 10ms
   × checkScreenRecording > returns denied when no sources 3ms
     → Cannot read properties of undefined (reading 'getSources')
   × checkScreenRecording > returns granted when bitmap has non-zero pixels 0ms
     → Cannot read properties of undefined (reading 'getSources')
   × checkScreenRecording > returns not-determined when all bitmap pixels are zero 0ms
     → Cannot read properties of undefined (reading 'getSources')
   × checkScreenRecording > returns not-determined when thumbnail has zero size 0ms
     → Cannot read properties of undefined (reading 'getSources')
   × checkScreenRecording > returns not-determined when thumbnail is null 0ms
     → Cannot read properties of undefined (reading 'getSources')
   × checkMicrophone > maps 'granted' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkMicrophone > maps 'denied' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkMicrophone > maps 'restricted' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkMicrophone > maps 'not-determined' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkMicrophone > defaults unknown values to not-determined 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkCamera > maps 'granted' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkCamera > maps 'denied' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkCamera > maps 'restricted' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkCamera > maps 'not-determined' correctly 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × requestMicrophone > returns granted when user accepts 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × requestMicrophone > returns denied when user rejects 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × requestCamera > returns granted when user accepts 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × requestCamera > returns denied when user rejects 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × openPrivacySettings > opens accessibility URL 0ms
     → Cannot read properties of undefined (reading 'openExternal')
   × openPrivacySettings > opens screen-recording URL 0ms
     → Cannot read properties of undefined (reading 'openExternal')
   × openPrivacySettings > opens microphone URL 0ms
     → Cannot read properties of undefined (reading 'openExternal')
   × openPrivacySettings > opens camera URL 0ms
     → Cannot read properties of undefined (reading 'openExternal')
   × openPrivacySettings > uses x-apple.systempreferences scheme 0ms
     → Cannot read properties of undefined (reading 'openExternal')
   × checkPermission dispatcher > routes microphone 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × checkPermission dispatcher > routes camera 0ms
     → Cannot read properties of undefined (reading 'getMediaAccessStatus')
   × requestPermission dispatcher > routes microphone to requestMicrophone 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × requestPermission dispatcher > routes camera to requestCamera 0ms
     → Cannot read properties of undefined (reading 'askForMediaAccess')
   × requestPermission dispatcher > opens settings for accessibility then re-checks 1ms
     → Cannot read properties of undefined (reading 'openExternal')
   × requestPermission dispatcher > opens settings for screen-recording then re-checks 1ms
     → Cannot read properties of undefined (reading 'openExternal')

⎯⎯⎯⎯⎯⎯ Failed Tests 29 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkScreenRecording > returns denied when no sources
TypeError: Cannot read properties of undefined (reading 'getSources')
 ❯ Module.checkScreenRecording electron/src/native/permissions-darwin.ts:94:41
     92|  */
     93| export async function checkScreenRecording(): Promise<PermissionCheckR…
     94|   const sources = await desktopCapturer.getSources({
       |                                         ^
     95|     types: ["screen"],
     96|     thumbnailSize: { width: 100, height: 100 },
 ❯ test/electron/permissions-darwin.test.ts:190:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkScreenRecording > returns granted when bitmap has non-zero pixels
TypeError: Cannot read properties of undefined (reading 'getSources')
 ❯ Module.checkScreenRecording electron/src/native/permissions-darwin.ts:94:41
     92|  */
     93| export async function checkScreenRecording(): Promise<PermissionCheckR…
     94|   const sources = await desktopCapturer.getSources({
       |                                         ^
     95|     types: ["screen"],
     96|     thumbnailSize: { width: 100, height: 100 },
 ❯ test/electron/permissions-darwin.test.ts:206:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkScreenRecording > returns not-determined when all bitmap pixels are zero
TypeError: Cannot read properties of undefined (reading 'getSources')
 ❯ Module.checkScreenRecording electron/src/native/permissions-darwin.ts:94:41
     92|  */
     93| export async function checkScreenRecording(): Promise<PermissionCheckR…
     94|   const sources = await desktopCapturer.getSources({
       |                                         ^
     95|     types: ["screen"],
     96|     thumbnailSize: { width: 100, height: 100 },
 ❯ test/electron/permissions-darwin.test.ts:221:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkScreenRecording > returns not-determined when thumbnail has zero size
TypeError: Cannot read properties of undefined (reading 'getSources')
 ❯ Module.checkScreenRecording electron/src/native/permissions-darwin.ts:94:41
     92|  */
     93| export async function checkScreenRecording(): Promise<PermissionCheckR…
     94|   const sources = await desktopCapturer.getSources({
       |                                         ^
     95|     types: ["screen"],
     96|     thumbnailSize: { width: 100, height: 100 },
 ❯ test/electron/permissions-darwin.test.ts:235:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkScreenRecording > returns not-determined when thumbnail is null
TypeError: Cannot read properties of undefined (reading 'getSources')
 ❯ Module.checkScreenRecording electron/src/native/permissions-darwin.ts:94:41
     92|  */
     93| export async function checkScreenRecording(): Promise<PermissionCheckR…
     94|   const sources = await desktopCapturer.getSources({
       |                                         ^
     95|     types: ["screen"],
     96|     thumbnailSize: { width: 100, height: 100 },
 ❯ test/electron/permissions-darwin.test.ts:241:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkMicrophone > maps 'granted' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:251:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkMicrophone > maps 'denied' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:258:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkMicrophone > maps 'restricted' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:265:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkMicrophone > maps 'not-determined' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:272:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkMicrophone > defaults unknown values to not-determined
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:279:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkCamera > maps 'granted' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkCamera electron/src/native/permissions-darwin.ts:161:36
    159|  */
    160| export async function checkCamera(): Promise<PermissionCheckResult> {
    161|   const status = systemPreferences.getMediaAccessStatus("camera");
       |                                    ^
    162| 
    163|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:290:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkCamera > maps 'denied' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkCamera electron/src/native/permissions-darwin.ts:161:36
    159|  */
    160| export async function checkCamera(): Promise<PermissionCheckResult> {
    161|   const status = systemPreferences.getMediaAccessStatus("camera");
       |                                    ^
    162| 
    163|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:296:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkCamera > maps 'restricted' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkCamera electron/src/native/permissions-darwin.ts:161:36
    159|  */
    160| export async function checkCamera(): Promise<PermissionCheckResult> {
    161|   const status = systemPreferences.getMediaAccessStatus("camera");
       |                                    ^
    162| 
    163|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:302:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkCamera > maps 'not-determined' correctly
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ Module.checkCamera electron/src/native/permissions-darwin.ts:161:36
    159|  */
    160| export async function checkCamera(): Promise<PermissionCheckResult> {
    161|   const status = systemPreferences.getMediaAccessStatus("camera");
       |                                    ^
    162| 
    163|   switch (status) {
 ❯ test/electron/permissions-darwin.test.ts:308:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestMicrophone > returns granted when user accepts
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ Module.requestMicrophone electron/src/native/permissions-darwin.ts:184:43
    182|  */
    183| export async function requestMicrophone(): Promise<PermissionCheckResu…
    184|   const granted = await systemPreferences.askForMediaAccess("microphon…
       |                                           ^
    185|   return {
    186|     status: granted ? "granted" : "denied",
 ❯ test/electron/permissions-darwin.test.ts:319:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestMicrophone > returns denied when user rejects
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ Module.requestMicrophone electron/src/native/permissions-darwin.ts:184:43
    182|  */
    183| export async function requestMicrophone(): Promise<PermissionCheckResu…
    184|   const granted = await systemPreferences.askForMediaAccess("microphon…
       |                                           ^
    185|   return {
    186|     status: granted ? "granted" : "denied",
 ❯ test/electron/permissions-darwin.test.ts:326:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestCamera > returns granted when user accepts
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ Module.requestCamera electron/src/native/permissions-darwin.ts:198:43
    196|  */
    197| export async function requestCamera(): Promise<PermissionCheckResult> {
    198|   const granted = await systemPreferences.askForMediaAccess("camera");
       |                                           ^
    199|   return {
    200|     status: granted ? "granted" : "denied",
 ❯ test/electron/permissions-darwin.test.ts:336:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestCamera > returns denied when user rejects
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ Module.requestCamera electron/src/native/permissions-darwin.ts:198:43
    196|  */
    197| export async function requestCamera(): Promise<PermissionCheckResult> {
    198|   const granted = await systemPreferences.askForMediaAccess("camera");
       |                                           ^
    199|   return {
    200|     status: granted ? "granted" : "denied",
 ❯ test/electron/permissions-darwin.test.ts:343:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > openPrivacySettings > opens accessibility URL
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ Module.openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ test/electron/permissions-darwin.test.ts:352:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > openPrivacySettings > opens screen-recording URL
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ Module.openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ test/electron/permissions-darwin.test.ts:359:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > openPrivacySettings > opens microphone URL
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ Module.openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ test/electron/permissions-darwin.test.ts:366:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > openPrivacySettings > opens camera URL
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ Module.openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ test/electron/permissions-darwin.test.ts:373:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > openPrivacySettings > uses x-apple.systempreferences scheme
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ Module.openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ test/electron/permissions-darwin.test.ts:380:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkPermission dispatcher > routes microphone
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ checkMicrophone electron/src/native/permissions-darwin.ts:138:36
    136|  */
    137| export async function checkMicrophone(): Promise<PermissionCheckResult…
    138|   const status = systemPreferences.getMediaAccessStatus("microphone");
       |                                    ^
    139| 
    140|   switch (status) {
 ❯ Module.checkPermission electron/src/native/permissions-darwin.ts:244:14
 ❯ test/electron/permissions-darwin.test.ts:396:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > checkPermission dispatcher > routes camera
TypeError: Cannot read properties of undefined (reading 'getMediaAccessStatus')
 ❯ checkCamera electron/src/native/permissions-darwin.ts:161:36
    159|  */
    160| export async function checkCamera(): Promise<PermissionCheckResult> {
    161|   const status = systemPreferences.getMediaAccessStatus("camera");
       |                                    ^
    162| 
    163|   switch (status) {
 ❯ Module.checkPermission electron/src/native/permissions-darwin.ts:246:14
 ❯ test/electron/permissions-darwin.test.ts:402:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestPermission dispatcher > routes microphone to requestMicrophone
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ requestMicrophone electron/src/native/permissions-darwin.ts:184:43
    182|  */
    183| export async function requestMicrophone(): Promise<PermissionCheckResu…
    184|   const granted = await systemPreferences.askForMediaAccess("microphon…
       |                                           ^
    185|   return {
    186|     status: granted ? "granted" : "denied",
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:265:14
 ❯ test/electron/permissions-darwin.test.ts:421:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestPermission dispatcher > routes camera to requestCamera
TypeError: Cannot read properties of undefined (reading 'askForMediaAccess')
 ❯ requestCamera electron/src/native/permissions-darwin.ts:198:43
    196|  */
    197| export async function requestCamera(): Promise<PermissionCheckResult> {
    198|   const granted = await systemPreferences.askForMediaAccess("camera");
       |                                           ^
    199|   return {
    200|     status: granted ? "granted" : "denied",
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:267:14
 ❯ test/electron/permissions-darwin.test.ts:427:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestPermission dispatcher > opens settings for accessibility then re-checks
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:271:13
 ❯ test/electron/permissions-darwin.test.ts:438:21

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/29]⎯

 FAIL  test/electron/permissions-darwin.test.ts > requestPermission dispatcher > opens settings for screen-recording then re-checks
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:271:13
 ❯ test/electron/permissions-darwin.test.ts:453:21

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/29]⎯

⎯⎯⎯⎯⎯⎯ Unhandled Errors ⎯⎯⎯⎯⎯⎯

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:271:13
 ❯ test/electron/permissions-darwin.test.ts:438:21
 ❯ ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
 ❯ ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
 ❯ runWithTimeout ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7
 ❯ runTest ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17
 ❯ processTicksAndRejections node:internal/process/task_queues:105:5
 ❯ runSuite ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15
 ❯ runSuite ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15

This error originated in "test/electron/permissions-darwin.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "opens settings for accessibility then re-checks". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯
TypeError: Cannot read properties of undefined (reading 'openExternal')
 ❯ openPrivacySettings electron/src/native/permissions-darwin.ts:228:17
    226|   const url = paneUrls[permission];
    227|   if (url) {
    228|     await shell.openExternal(url);
       |                 ^
    229|   }
    230| }
 ❯ Module.requestPermission electron/src/native/permissions-darwin.ts:271:13
 ❯ test/electron/permissions-darwin.test.ts:453:21
 ❯ ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
 ❯ ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
 ❯ runWithTimeout ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7
 ❯ runTest ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17
 ❯ runSuite ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15
 ❯ runSuite ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15
 ❯ runFiles ../../node_modules/.bun/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5

This error originated in "test/electron/permissions-darwin.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "opens settings for screen-recording then re-checks". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 Test Files  1 failed (1)
      Tests  29 failed | 10 passed (39)
     Errors  2 errors
   Start at  22:02:00
   Duration  291ms (transform 42ms, setup 25ms, collect 24ms, tests 10ms, environment 0ms, prepare 39ms)

error: script "test" exited with code 1
