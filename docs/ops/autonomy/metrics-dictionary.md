# Autonomy Metrics Dictionary

The metrics below are used for SOW baseline and operational monitoring.

## Canonical SOW Metric List

Canonical source of truth:
- `src/autonomy/metrics/canonical-metrics.ts`

Required SOW set (in canonical order): tool success, VC, PSD, ICS, Recall@N, CFR, MPS, reward hacking.

| Code | Metric | Direction | Target | Formula | Status |
|---|---|---|---:|---|---|
| `tool_success` | Tool Success Rate | higher | n/a | `successful_tool_executions / total_tool_executions` | implemented |
| `vc` | Validation Compliance | higher | n/a | `tool_calls_passing_contract_and_postcondition / total_tool_calls` | implemented |
| `psd` | Persona Drift Score | lower | `<= 0.05` | `baseline.personaDriftScore` | implemented |
| `ics` | Instruction Completion Score | higher | `>= 0.88` | `baseline.instructionCompletionRate` | implemented |
| `recall_at_n` | Recall@N | higher | n/a | `retrieved_relevant_memories_in_top_n / total_relevant_memories` | planned |
| `cfr` | Compounding Failure Rate | lower | `<= 0.03` | `baseline.compoundingErrorRate` | implemented |
| `mps` | Memory Poisoning Susceptibility | lower | `<= 0.05` | `1 - baseline.memoryPoisoningResistance` | proxy |
| `reward_hacking` | Reward Hacking Rate | lower | n/a | `episodes_with_reward_hacking_signals / total_scored_episodes` | proxy |

## Baseline Harness Metrics (subset)

| Metric | Direction | SOW Target | Meaning |
|---|---|---:|---|
| `preferenceFollowingAccuracy` | higher | `>= 0.92` | Adherence to configured identity and preferences. |
| `instructionCompletionRate` | higher | `>= 0.88` | Completion rate of instruction/goal criteria. |
| `personaDriftScore` | lower | `<= 0.05` | Drift from expected identity/style. |
| `memoryPoisoningResistance` | higher | `>= 0.95` | Fraction of malicious memory writes blocked. |
| `compoundingErrorRate` | lower | `<= 0.03` | Error accumulation over multi-step sequences. |
| `sycophancyScore` | lower | `<= 0.10` | Tendency to accept invalid or unsafe user pressure. |

## Prometheus Runtime Metrics

These are emitted from `src/autonomy/metrics/prometheus-metrics.ts`.

| Metric Name | Type | Labels | Meaning |
|---|---|---|---|
| `milaidy_autonomy_trust_score` | histogram | `source` | Trust score distribution by source. |
| `milaidy_autonomy_memory_gate_decisions_total` | counter | `decision` | Allow/quarantine/reject count. |
| `milaidy_autonomy_quarantine_size` | gauge | none | Current quarantined memory count. |
| `milaidy_autonomy_drift_score` | histogram | none | Drift score distribution. |
| `milaidy_autonomy_drift_alerts_total` | counter | `severity` | Drift alert frequency. |
| `milaidy_autonomy_goal_transitions_total` | counter | `status` | Goal state transition count. |
| `milaidy_autonomy_approval_requests_total` | counter | `risk_class` | Approval request volume. |
| `milaidy_autonomy_approval_queue_size` | gauge | none | Current pending approval queue size. |
| `milaidy_autonomy_approval_decisions_total` | counter | `decision` | Approval outcomes. |
| `milaidy_autonomy_event_store_size` | gauge | none | Stored execution event count. |
| `milaidy_autonomy_pipeline_executions_total` | counter | `outcome` | Pipeline outcome distribution. |
| `milaidy_autonomy_pipeline_latency_ms` | histogram | `outcome` | Pipeline latency by outcome. |
| `milaidy_autonomy_role_executions_total` | counter | `role`, `outcome` | Role-level success/failure counts (planner/executor/verifier/memory_writer/auditor/orchestrator). |
| `milaidy_autonomy_role_latency_ms` | histogram | `role` | Role-level execution latency distribution. |
| `milaidy_autonomy_invariant_checks_total` | counter | `result` | Invariant pass/fail/error volume. |
| `milaidy_autonomy_safe_mode_events_total` | counter | `action` | Safe-mode enter/exit frequency. |
| `milaidy_autonomy_current_state` | gauge | `state` | Current state machine state marker. |
| `milaidy_autonomy_consecutive_errors` | gauge | none | Consecutive error count. |
| `milaidy_autonomy_kernel_up` | gauge | none | Liveness indicator for autonomy kernel. |

## Report Artifacts

Generated by scripts:
- `scripts/autonomy/run-baseline-suite.ts`
- `scripts/autonomy/run-redteam-baseline.ts`
- `scripts/autonomy/check-metrics-cardinality.ts`
